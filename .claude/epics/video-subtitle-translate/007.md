# Task 007: 命令行界面

## Metadata
- **Created**: 2025-09-05T06:36:20Z
- **Status**: open
- **Epic**: video-subtitle-translate
- **Depends on**: [002, 003, 004, 005]
- **Parallel**: false
- **Effort**: M (2-3 days)

## Description
基于Click框架构建完整的命令行界面，提供直观的参数处理、实时进度显示、错误处理和帮助系统。这是用户体验的关键组件，需要整合所有核心模块（音频处理、语音识别、翻译引擎、字幕生成）提供统一的CLI入口。

实现用户友好的命令行界面，支持灵活的参数配置、实时进度反馈、错误恢复机制，确保工具具备生产级的可用性和稳定性。

## Acceptance Criteria
- [ ] 实现完整的Click CLI命令结构和参数解析
- [ ] 支持所有必要的命令行参数（输入文件、输出目录、模型选择等）
- [ ] 提供实时进度显示（音频提取、语音识别、翻译进度条）
- [ ] 实现优雅的错误处理和用户友好的错误消息
- [ ] 支持详细的帮助系统和参数验证
- [ ] 提供配置文件支持和参数覆盖机制
- [ ] 实现中断恢复功能（支持Ctrl+C后的状态保存）
- [ ] 添加详细的日志输出和调试模式
- [ ] 支持批量处理多个视频文件
- [ ] 所有CLI功能有对应的集成测试

## Technical Details
### CLI命令结构
```bash
# 基本用法
video-subtitle-translate process input.mp4

# 完整参数
video-subtitle-translate process input.mp4 \
  --output-dir ./output \
  --source-lang auto \
  --target-lang zh \
  --whisper-model small \
  --llm-backend ollama \
  --llm-model qwen2.5:7b \
  --interactive \
  --batch-size 10 \
  --resume-from ./cache \
  --config ./config.yaml
```

### 核心组件
1. **主命令组**: Click Group with subcommands
2. **参数验证**: Pydantic models for CLI arguments
3. **进度显示**: Rich progress bars with detailed status
4. **错误处理**: Graceful error handling with recovery suggestions
5. **配置系统**: YAML config file with CLI overrides
6. **状态管理**: Resume/interrupt handling with state persistence

### 主要功能
1. **process**: 主要的视频处理命令
2. **config**: 配置管理和验证
3. **models**: 模型下载和管理
4. **status**: 查看处理状态和统计信息
5. **clean**: 清理临时文件和缓存

### 参数设计
```python
@click.command()
@click.argument('input_file', type=click.Path(exists=True))
@click.option('--output-dir', '-o', default='./output', 
              help='输出目录')
@click.option('--source-lang', '-s', default='auto', 
              help='源语言（auto为自动检测）')
@click.option('--target-lang', '-t', required=True,
              help='目标语言')
@click.option('--whisper-model', default='small',
              type=click.Choice(['tiny', 'base', 'small', 'medium', 'large']))
@click.option('--llm-backend', default='auto',
              type=click.Choice(['auto', 'ollama', 'lmstudio']))
@click.option('--llm-model', help='LLM模型名称')
@click.option('--interactive/--no-interactive', default=False,
              help='启用交互式校对')
@click.option('--batch-size', default=10, type=int,
              help='翻译批处理大小')
@click.option('--resume-from', type=click.Path(),
              help='从指定缓存恢复处理')
@click.option('--config', type=click.Path(exists=True),
              help='配置文件路径')
@click.option('--verbose', '-v', count=True,
              help='详细输出（-v, -vv, -vvv）')
```

### 进度显示设计
```python
# 使用Rich库实现多级进度条
- 总体进度: [▓▓▓▓░░░░░░] 40% 处理中...
  - 音频提取: [▓▓▓▓▓▓▓▓▓▓] 100% 完成
  - 语音识别: [▓▓▓▓▓▓▓▓░░] 80% 识别中...
  - 翻译处理: [░░░░░░░░░░] 0% 等待中...
  - 字幕生成: [░░░░░░░░░░] 0% 等待中...
```

### 错误处理策略
1. **参数验证错误**: 清晰的参数说明和示例
2. **依赖检查错误**: 安装指导和检查脚本
3. **处理错误**: 详细错误信息和恢复建议
4. **资源错误**: 磁盘空间、内存使用检查
5. **网络错误**: 重试机制和离线模式提示

## Dependencies
需要以下任务完成：
- **Task 002**: 音频处理模块（FFmpeg集成、音频提取）
- **Task 003**: Whisper语音识别（语音转文本功能）
- **Task 004**: 本地LLM翻译（翻译引擎集成）
- **Task 005**: 双语字幕生成（SRT格式化输出）

这些核心功能模块需要通过CLI进行统一协调和调用。

## Effort Estimate
**Size**: M (2-3 days)

**Breakdown**:
- CLI架构设计和Click集成: 4小时
- 参数系统和配置管理: 4小时
- 进度显示和用户界面: 6小时
- 错误处理和恢复机制: 4小时
- 批量处理和状态管理: 6小时
- 集成测试和调试: 4小时
- 文档和帮助系统: 2小时

## Definition of Done
- [ ] CLI命令能够成功调用所有核心处理模块
- [ ] 参数验证正确，提供清晰的错误提示
- [ ] 进度条准确显示各阶段的处理状态
- [ ] 支持中断和恢复功能，状态持久化正常
- [ ] 错误处理机制完善，提供有用的解决建议
- [ ] 批量处理功能正常，支持多文件处理
- [ ] 配置文件系统工作正常，参数覆盖机制有效
- [ ] 帮助文档完整，命令行使用说明清晰
- [ ] 所有CLI功能通过集成测试验证
- [ ] 代码符合项目规范，通过所有质量检查